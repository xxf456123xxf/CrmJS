<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title></title>
  <script src="https://unpkg.com/jquery@2.2.4/dist/jquery.js"></script>
  <script src="https://unpkg.com/underscore/underscore.js"></script>
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <!-- 引入样式 -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <!-- 引入组件库 -->
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <style>
    .row-expand-cover .el-table__expand-column .el-icon {
      visibility: hidden;
    }

    .row-expand-cover .el-table__expand-column {
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="app">
  </div>
  <script>
    $.ajaxSetup({ cache: false });
    //调试时使用变量
    var baseurl = 'http://localhost:63869/api/'
    var request = {
      get: function (url) {
        return $.get(baseurl + url);
      }
    }

    var vm;
    function vueLoad(vueConfig) {
      var config = vueConfig || {}
      if (!config.url) {
        return;
      }

      var filters = {
        date: function (date, format) {
          if (date === undefined || date === null) {
            return ""
          }
          if (typeof date === 'string') {
            return new Date(date).Format(format || 'yyyy-MM-dd');
          }
          return date.Format(format || 'yyyy-MM-dd');
        },
      }

      var defaultConfig = {
        el: '#app', data: {
          defaultValue: 0,
          defaultText: 'defaultText'

        },
        filters: filters,
        methods: {
          close: function () {
            //关闭所有弹出层
            window.parent.layer.closeAll();
          }
        },
        beforeCreate: function () {
          // 'beforeCreate 创建前状态';

        },
        created: function () {
          //created 创建完毕状态;

        },
        beforeMount: function () {
          //beforeMount 挂载前状态

        },
        mounted: function () {
          //挂载结束状态

        },
        beforeUpdate: function () {
          //beforeUpdate 更新前状态

        },
        updated: function () {
          //updated 更新完成状态

        },
        beforeDestroy: function () {
          //beforeDestroy 销毁前状态

        },
        destroyed: function () {
          //destroyed 销毁完成状态

        }
      }
      //var methods = {

      //}
      //config.filters = $.extend(filters, config.filters)
      //config.methods = $.extend(methods, config.methods)

      var _config = $.extend({ mixins: [defaultConfig] }, config)

      $.get(config.url).then(function (html) {
        $('#app').html('<template>' + $(html).filter('template').html() + '<template>')

        $('head').append('<style>' + ($(html).filter('style').html() || '') + '<style>')
        var v_config = eval('function v_config() {' + $(html).filter('script').html().replace('export default', 'return') + '};v_config()');
        if (v_config) {
          _config.mixins.push(v_config);
        }
        vm = new Vue(_config);
      })
    }
    Date.prototype.Format = function (fmt) { // author: meizz
      var o = {
        'M+': this.getMonth() + 1,                 // 月份
        'd+': this.getDate(),                    // 日
        'h+': this.getHours(),                   // 小时
        'm+': this.getMinutes(),                 // 分
        's+': this.getSeconds(),                 // 秒
        'q+': Math.floor((this.getMonth() + 3) / 3), // 季度
        'S': this.getMilliseconds()             // 毫秒
      }
      var FMT = fmt
      if (/(y+)/.test(FMT)) {
        FMT = FMT.replace(RegExp.$1, (this.getFullYear() + '').substr(4 - RegExp.$1.length))
      }
      for (var k in o) {
        if (new RegExp('(' + k + ')').test(FMT)) {
          FMT = FMT.replace(RegExp.$1, (RegExp.$1.length === 1) ? (o[k]) : (('00' + o[k]).substr(('' + o[k]).length)))
        }
      }
      return FMT
    }
    Date.prototype.addDays = function (days) {
      var date = new Date()
      var milliseconds = this.getTime() + days * 24 * 60 * 60 * 1000
      date.setTime(milliseconds)
      return new Date(date.getFullYear(), date.getMonth(), date.getDate())
    }

    Array.prototype.insert = function (index, item) {
      this.splice(index, 0, item);
    };
    Array.prototype.remove = function (val) {
      var index = this.indexOf(val);
      if (index > -1) {
        this.splice(index, 1);
      }
    };
  </script>
</body>
</html>
